@using SigortaApp.Entity.Dto
@using X.PagedList
@using X.PagedList.Mvc.Core
@model IPagedList<DevicesUsersDto>
@{
    ViewData["Title"] = "GetChildList";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}


<h1>@Model.First().Types.Name Listesi</h1>
<br />
<table class="table table-hover">
    <thead>
        <tr>
            <th>#</th>
            <th>Kategori</th>
            <th>Marka</th>
            <th>Model</th>
            <th>Seri Numarası</th>
            <th>Açıklama</th>
            <th>Dolap No</th>
            <th>Ekleyen Kişi</th>
            <th>Eklenen Tarih</th>
            <th>İşlemler</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <th>@item.Id</th>
                <td>@item.Category.Name</td>
                <td>@item.Brand.Name</td>
                <td>@item.Types.Name</td>
                <td>@item.SerialNumber</td>
                <td>@item.Description</td>
                <td>@item.CupboardNumber</td>
                <td>@item.UserName</td>
                <td>@(((DateTime)item.CreatedDate).ToString("dd-MMM-yyyy"))</td>
                <td>
                    <a href="/Admin/Devices/DeleteDevice/@item.Id" onclick="return confirm('Silmek istediğinize emin misiniz?');" class="btn btn-outline-danger">Sil</a>
                    <a href="#" class="btn btn-outline-success" onclick="funcUpdateDevice(@item.Id)">Güncelle</a>
                </td>
            </tr>
        }

    </tbody>
</table>
@Html.PagedListPager((IPagedList)Model,page=>Url.Action("GetChildList", new { page}))
<br />
<a href="/Admin/Devices/Index/" class="btn btn-outline-success">Geri Dön</a>


<div class="modal inmodal fade" id="updatechilddevice" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Ürün Ekle</h4>
            </div>
            <form method="post" action="@Url.Action("AddDevices", "Devices")">
                <div class="modal-body">
                    <input type="text" id="devceid" name="Id" value="0" hidden />
                    <div class="form-control">
                        <label>Kategori</label>
                        @*<input type="text" name="Name" class="form-control" />*@
                        @Html.DropDownList("CategoryId",ViewBag.cv,"Kategori Seçiniz..",new { @class = "form-control", @id="categoryid", @onchange="funcClearRows()" })
                    </div>
                    <br />
                    <div class="form-control">
                        <label>Marka Adı</label>
                        @*<input type="text" name="Name" class="form-control" />*@
                        @Html.DropDownList("BrandId",ViewBag.bv,"Marka Seçiniz..",new { @class = "form-control", @id="brandId", @onchange="funcGetTypes()" })
                    </div>
                    <br />
                    <div class="form-control">
                        <label>Model Adı</label>
                        @*<input type="text" name="Name" class="form-control" />*@
                        @*@Html.DropDownList("TypesId",List<null>,"Model Seçiniz..",new { @class = "form-control", @id="typesId" })*@
                        <select id="typid" class="form-control" name="TypesId">
                            <option disabled selected hidden>Model Seçiniz..</option>
                        </select>
                    </div>
                    <br />
                    <div class="form-control">
                        <label>Seri Numarası</label>
                        <textarea name="SerialNumber" id="serinumber" class="form-control"> </textarea>
                    </div>
                    <br />
                    <div class="form-control">
                        <label>Açıklama</label>
                        <input type="text" name="Description" id="desc" class="form-control" />
                    </div>
                    <br />
                    <div class="form-control">
                        <label>Dolap No</label>
                        <input type="number" max="10" min="0" id="cupboardno" name="CupboardNumber" value="0" placeholder="Lütfen sayı giriniz." class="form-control" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />
                    </div>
                    <br />
                    <div class="form-control">
                        <label>Adet</label>
                        <input type="number" max="1000" min="1" id="numberno" name="Number" value="1" placeholder="Lütfen adet giriniz." class="form-control" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />
                    </div>



                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Vazgeç</button>
                    <input type="submit" class="btn btn-primary" value="Kaydet" />
                </div>
            </form>
        </div>
    </div>
</div>



<script type="text/javascript">
    function funcGetTypes(e) {
        var brand = document.getElementById("brandId").value;
        var category = document.getElementById("categoryid").value;

        $.ajax({
            type: "GET",
            url: "@Url.Action("TypesByBrand")",
            data: { brandId: brand, categoryId: category },
            dataType: "JSON",
            success: function (msg) {
                $('#typid option').remove();
                for (var i = 0; i < msg.length; i++) {
                    var ddl = document.getElementById("typid");
                    var option = document.createElement("OPTION");
                    option.innerHTML = msg[i].text;
                    option.value = msg[i].value;
                    ddl.options.add(option);
                }

            },
            error: function (req, status, error) {
                console.log(msg);
            }
        });
    }

    function funcModalRefresh() {
        document.getElementById("categoryid").value = "";
        document.getElementById("brandId").value = "";
        $("#typid").val("").trigger('change');
        document.getElementById("serinumber").value = "";
        document.getElementById("desc").value = "";
        document.getElementById("cupboardno").value = "";
        document.getElementById("devceid").value = "";
        document.getElementById("numberno").value = "";
    }

    function funcUpdateDevice(id) {
        $.ajax({
            url: '/Admin/Devices/UpdateDevices/' + id,
            type: "GET",
            dataType: "JSON",
            success: function (results2) {
                $("#updatechilddevice").modal();
                funcModalRefresh();
                document.getElementById("categoryid").value = results2.categoryId;
                document.getElementById("brandId").value = results2.brandId;
                funcGetTypes();
                document.getElementById("brandId").value = results2.brandId;
                $("#typid").val(results2.typesId).trigger('change');
                //document.getElementById("typesId").value = results2.typesId;
                document.getElementById("serinumber").value = results2.serialNumber;
                document.getElementById("desc").value = results2.description;
                document.getElementById("cupboardno").value = results2.cupboardNumber;
                document.getElementById("devceid").value = results2.id;
            }
        });
    }

    function funcClearRows() {
        document.getElementById("brandId").value = "";
        $("#typid").val("").trigger('change');
    }

</script>